<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LoopTasks · Gestión de Tareas</title>
  <meta name="color-scheme" content="light" />
  <meta name="description" content="LoopTasks: gestor de tareas con Google Sheets + Telegram. Frontend estático que embebe tu Apps Script Web App." />
  <style>
    :root{ --bg:#f6f1e7; --panel:#fff9f0; --ink:#2b2b2b; --accent:#8b5e34; --line:#eadfcf; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--panel),#fff);
      border-bottom:1px solid var(--line);padding:18px 20px}
    .brand{display:flex;align-items:baseline;gap:10px}
    .brand h1{margin:0;font-size:22px;letter-spacing:.2px}
    .brand small{color:#7a6d5a}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 1px 0 rgba(0,0,0,.03)}
    .grid{display:grid;gap:12px}
    @media(min-width:720px){.grid.cols-2{grid-template-columns:1fr 1fr}}
    label{font-size:13px;color:#6b5c49}
    input{width:100%;padding:12px;border:1px solid var(--line);border-radius:12px;background:#fff;color:var(--ink)}
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--accent);background:var(--accent);color:#fff;
      padding:10px 14px;border-radius:10px;cursor:pointer;text-decoration:none;display:inline-flex;gap:8px;align-items:center}
    .btn.secondary{background:#fff;color:var(--accent)}
    iframe{width:100%;min-height:72vh;border:1px solid var(--line);background:#fff;border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,.03)}
    .hint{color:#7a6d5a;font-size:13px}
    footer{padding:28px 18px;color:#9b8a72;text-align:center;font-size:12px}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#fff}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <h1>LoopTasks</h1>
      <small>Sheets + Telegram · Website estático (embebido)</small>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="grid cols-2" style="align-items:end">
        <div>
          <label for="webapp-url">URL de tu Apps Script Web App</label>
          <input id="webapp-url" type="url" placeholder="https://script.google.com/macros/s/AKfycbyODgO8QzbKEmj35JGzch5Q-_Yr8G21s3oxcltaXoMRUi5OgGrFX2e0IXSSJT7DXOLdUg/exec" />
          <div class="hint">Puedes reemplazar la URL por otra si haces un nuevo despliegue. La guardaremos solo en tu navegador.</div>
        </div>
        <div class="actions">
          <button id="btn-guardar" class="btn">Usar esta URL</button>
          <a id="btn-limpiar" href="#" class="btn secondary">Limpiar</a>
          <a id="btn-abrir" href="#" target="_blank" rel="noopener" class="btn secondary">Abrir en nueva pestaña</a>
        </div>
      </div>
    </section>

    <div style="height:12px"></div>

    <section class="card">
      <div class="actions" style="justify-content:space-between">
        <div class="hint">Si el recuadro se ve vacío, verifica que tu Web App tenga acceso <b>“Anyone with the link”</b>.</div>
        <div><span class="pill">Estado: <span id="status">Conectado</span></span></div>
      </div>
      <div style="height:12px"></div>
      <iframe id="app" title="LoopTasks App" loading="lazy" allow="clipboard-write *" src="https://script.google.com/macros/s/AKfycbyODgO8QzbKEmj35JGzch5Q-_Yr8G21s3oxcltaXoMRUi5OgGrFX2e0IXSSJT7DXOLdUg/exec"></iframe>
    </section>
  </main>

  <footer>© LoopTasks · Este sitio estático embebe tu Apps Script Web App.</footer>

  <script>
    const KEY = "looptasks_webapp_url";
    const input = document.getElementById("webapp-url");
    const frame = document.getElementById("app");
    const btnSave = document.getElementById("btn-guardar");
    const btnClear = document.getElementById("btn-limpiar");
    const btnOpen = document.getElementById("btn-abrir");
    const statusEl = document.getElementById("status");

    // URL incrustada por defecto (la que me compartiste)
    const DEFAULT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyODgO8QzbKEmj35JGzch5Q-_Yr8G21s3oxcltaXoMRUi5OgGrFX2e0IXSSJT7DXOLdUg/exec";

    function persist(u){ try{ localStorage.setItem(KEY, u); }catch(_){} }
    function read(){ try{ return localStorage.getItem(KEY); }catch(_ ){ return null; } }
    function erase(){ try{ localStorage.removeItem(KEY); }catch(_){} }

    function updateUI(u){
      if(u){ frame.src = u; btnOpen.href = u; statusEl.textContent = "Conectado"; }
      else{ frame.removeAttribute("src"); btnOpen.removeAttribute("href"); statusEl.textContent = "Sin URL"; }
    }

    (function init(){
      input.value = DEFAULT_WEB_APP_URL;
      // Si el usuario ya guardó otra, respétala
      const saved = read();
      if(saved && saved.trim() && saved !== DEFAULT_WEB_APP_URL){ input.value = saved; updateUI(saved); }
    })();

    btnSave.addEventListener("click", (e)=>{
      e.preventDefault();
      const u = (input.value||"").trim();
      if(!u){ alert("Pega la URL de tu Web App (termina en /exec)."); return; }
      persist(u); updateUI(u);
    });

    btnClear.addEventListener("click", (e)=>{ e.preventDefault(); erase(); input.value = DEFAULT_WEB_APP_URL; updateUI(DEFAULT_WEB_APP_URL); });

    // Auto-resize opcional (si la Web App publica su altura con postMessage)
    window.addEventListener("message", (ev)=>{
      if(!ev || !ev.data) return;
      if(typeof ev.data === "object" && ev.data.type === "looptasks:height"){
        const h = Number(ev.data.value||0);
        if(h>200) frame.style.minHeight = h + "px";
      }
    });
  </script>
</body>
</html>
